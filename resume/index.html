<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Vereloop ‚Äì Optimize Your Resume with AI">
    <meta property="og:description"
        content="Instant resume analysis. Upload your resume and get job match scores, missing keywords, and optimization tips.">
    <meta property="og:image" content="https://vereloop.com/assets/og-image.jpg">
    <meta property="og:url" content="https://vereloop.com">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="google-site-verification" content="CqUR0V0tOlkzDOC62u2_KwmilVNQYtp1EYmQ1kG-77Q" />

    <title>Chat with Resume</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #1f2937;
        }

        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }

        .section {
            margin-bottom: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .keywords span {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            margin: 5px 6px 0 0;
            font-size: 14px;
        }

        .missing {
            background: #fee2e2;
            color: #b91c1c;
        }

        .found {
            background: #dcfce7;
            color: #166534;
        }

        .badge {
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 12px;
            margin-left: 8px;
        }

        .technical {
            background: #ede9fe;
            color: #7c3aed;
        }

        .soft {
            background: #dcfce7;
            color: #15803d;
        }

        .domain {
            background: #fed7aa;
            color: #c2410c;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e5e7eb;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress {
            height: 10px;
            background: #7c3aed;
        }

        ul li {
            margin-bottom: 8px;
        }

        .score {
            font-size: 40px;
            font-weight: bold;
            color: #dc2626;
        }

        .title-section {
            text-align: center;
        }

        .title-section h1 {
            font-size: 2rem;
            color: #6a0dad;
        }

        .title-section p {
            margin-top: 0.5rem;
            color: #555;
        }

        .input-sections {
            display: flex;
            gap: 2rem;
            margin-top: 2rem;
        }

        .box {
            flex: 1;
            border: 2px dashed #d3bfff;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            background-color: #f9f5ff;
            position: relative;
        }

        .box h3 {
            margin-top: 0;
            color: #6a0dad;
        }

        .box input[type="file"],
        .box textarea {
            margin-top: 1rem;
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
        }

        .step-label {
            position: absolute;
            top: -15px;
            left: 15px;
            background-color: #ede3ff;
            color: #6a0dad;
            font-weight: bold;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .button-wrapper {
            text-align: center;
            margin-top: 2rem;
        }

        .button-wrapper button {
            background-color: #a56bff;
            color: white;
            padding: 0.75rem 2rem;
            font-size: 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            opacity: 1;
        }

        .features {
            display: flex;
            gap: 2rem;
            margin-top: 2rem;
        }

        .feature-box {
            flex: 1;
            background-color: #f4edff;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
        }

        .feature-box h4 {
            color: #6a0dad;
            margin-bottom: 0.5rem;
        }

        #form-section,
        #loading_screen,
        #analysis-section {
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 6px solid #e5e7eb;
            border-top: 6px solid #7c3aed;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .row {
            display: flex;
            gap: .75rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .meta {
            font-size: .9rem;
            color: #6b7280;
            margin-top: .5rem;
        }

        .divider {
            height: 1px;
            background: #e5e7eb;
            margin: 1rem 0;
        }

        .hint {
            font-size: .9rem;
            color: #6b7280;
            margin-top: .5rem;
        }

        .empty {
            background: #f3f4f6;
            border: 1px dashed #d1d5db;
            color: #6b7280;
            padding: .85rem 1rem;
            border-radius: 10px;
        }

        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif;
            background: #f8fafc;
            color: #0f172a;
            margin: 0;
            padding: 2rem
        }

        .row {
            display: flex;
            gap: .5rem;
            flex-wrap: wrap;
            align-items: center
        }

        select,
        button {
            padding: .55rem .75rem;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            background: #fff;
            font-size: 1rem
        }

        button.primary {
            background: #4f46e5;
            color: #fff;
            border-color: #4f46e5
        }

        button.danger {
            color: #dc2626;
            border-color: #fecaca;
            background: #fff
        }

        .muted {
            color: #64748b
        }
    </style>
</head>

<body>
    <div id="header-placeholder"></div>

    <!--form-section -->
    <div class="container" id="form-section">

        <div id="header-placeholder"></div>

        <div class="title-section">
            <h1>Get Your Resume <strong>Analyzed</strong></h1>
            <p>Upload your resume and job description to get detailed insights, improvement suggestions, and match
                analysis
                powered by AI.</p>
        </div>

        <section style="max-width: 960px; margin: 0 auto; padding: 2rem; text-align: center;">
            <h2 style="font-size: 2rem; color: #4f46e5; margin-bottom: 0.5rem;">üé• How Vereloop Works</h2>
            <p style="font-size: 1.1rem; margin-bottom: 1.5rem; color: #374151;">
                Following is a quick visual breaksown to get an instant match score, keyword breakdown, and smart
                resume tips.
            </p>
            <img src="https://vereloopadls.blob.core.windows.net/vereloop/vereloop-demo.gif?sp=r&st=2025-08-14T09:22:33Z&se=2026-08-14T17:37:33Z&spr=https&sv=2024-11-04&sr=b&sig=dVfCF09LuzRiSjgZT7BIDua12MbXhTkCan64AHiHdMg%3D"
                alt="Product Walkthrough GIF"
                style="max-width: 100%; border-radius: 8px; box-shadow: 0 5px 25px rgba(0,0,0,0.05);" />
        </section>

        <div class="input-sections">

            <div class="box" id="resumeUploadBox">
                <div class="step-label">1 Upload Resume</div>
                <h3 id="uploadTitle">Upload Resume</h3>
                <p id="uploadPrompt">Choose from dropdown or drop your PDF file here or click to browse</p>
                <!-- <input type="file" id="resumeFile" accept=".pdf"> -->

                <!-- Source selectors -->
                <div class="row" style="margin-bottom:.5rem;">
                    <span class="pill">Option A: Upload new</span>
                    <input type="file" id="resumeFile" accept=".pdf,.doc,.docx" />
                    <span id="fileMeta" class="muted"></span>
                </div>

                <div class="row" style="margin-bottom:.5rem;">
                    <span class="pill">Option B: Choose existing</span>
                    <select id="resumeSelect" aria-label="Choose a resume">
                        <option value="" selected disabled>-- Select from saved resumes --</option>
                    </select>
                    <button id="resumeRefreshBtn" class="btn">Refresh</button>
                    <button id="resumeViewBtn" class="btn">View</button>
                </div>

                <div id="resumeMeta" class="meta"></div>

                <div class="divider"></div>

                <p class="hint">Tip: The newest resume appears first. You can rename or add resumes on the ‚ÄúMy
                    Documents‚Äù page.
                </p>

                <div id="emptyState" class="empty" style="display:none; margin-top:1rem;">
                    No resumes found in IndexedDB. Please upload one on the <a href="/documents.html">My Documents</a>
                    page first.
                </div>

                <!-- File details preview -->
                <div id="fileInfo"
                    style="display: none; margin-top: 10px; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center;">
                        <strong id="fileName">Uploaded file.pdf</strong>
                        <button id="viewFileBtn"
                            style="display: none; margin-left: 10px; padding: 4px 10px; font-size: 0.85rem; cursor: pointer;">üëÅÔ∏è
                            View</button>
                    </div>
                    <button id="removeFileBtn"
                        style="display: none; margin-left: 10px; padding: 4px 10px; font-size: 0.85rem; background-color: #f87171; color: white; border: none; border-radius: 4px; cursor: pointer;">‚úñ
                        Remove</button>
                </div>
            </div>

            <div class="box">
                <div class="step-label">2 Job Description</div>
                <h3>Job Description</h3>
                <p>Paste the complete job description here</p>
                <textarea id="jobDescription" rows="8"
                    placeholder="Include responsibilities, skills, and requirements..."></textarea>
            </div>
        </div>

        <div class="button-wrapper">
            <button id="analyzeBtn">Analyze Resume</button>
            <p style="margin-top: 0.5rem; color: #999;">Please upload your resume and provide a job description to
                continue
            </p>
        </div>

        <div class="features">
            <div class="feature-box">
                <h4>Resume Matching</h4>
                <p>Get a detailed relevancy score showing how well your resume matches the job requirements.</p>
            </div>
            <div class="feature-box">
                <h4>Skills Analysis</h4>
                <p>Identify missing keywords and skills to help optimize your resume for ATS systems.</p>
            </div>
            <div class="feature-box">
                <h4>AI Recommendations</h4>
                <p>Receive personalized suggestions to improve your resume and increase your chances.</p>
            </div>
        </div>

        <div class="divider"></div>

        <!--AI Responses  -->
        <h1>AI Responses</h1>
        <p class="muted">Analyzed resume responses are stored locally (IndexedDB). Latest appears first, only 10 kept.
        </p>
        <div class="box" style="margin:.75rem 0 1rem">
            <select id="respSelect" aria-label="Saved responses">
                <option value="" selected disabled>-- Select a saved response --</option>
            </select>
            <button id="respViewBtn">View</button>
            <button id="respRenameBtn">Rename</button>
            <button id="respDeleteBtn" class="danger">Delete</button>
            <button id="respRefreshBtn">Refresh</button>
        </div>

        <!-- <div class="row">
            <button id="respSimulatePost" class="primary">Simulate POST ‚Üí Save</button>
            <span id="status" class="muted"></span>
        </div> -->

        <!-- AI Responses -->

    </div>

    <!--loading_screen -->
    <div id="loading_screen" style="display: none; text-align: center; padding: 50px;">
        <div class="spinner"></div>
        <p style="margin-top: 20px; font-size: 1.2rem; color: #7c3aed;">Analyzing your resume with AI magic...</p>
    </div>

    <script type="module">
        // Load header once (IDs must be unique; ensure only one #header-placeholder)
        fetch("/reusables/header.html")
            .then(res => res.text())
            .then(html => { document.getElementById("header-placeholder").innerHTML = html; })
            .catch(console.error);

        const formSection = document.getElementById('form-section');
        const loadingScreen = document.getElementById('loading_screen');
        formSection.style.display = 'block';

        // ---------- Utilities ----------
        const formatBytes = (n) => {
            if (n == null) return '‚Äî';
            const u = ['B', 'KB', 'MB', 'GB']; let i = 0;
            while (n >= 1024 && i < u.length - 1) { n /= 1024; i++; }
            return `${(n < 10 && i > 0) ? n.toFixed(1) : Math.round(n)} ${u[i]}`;
        };
        const fmtDate = (d) => new Date(d).toLocaleString();

        // ---------- Resume DB (vereloop/resumes) ----------
        const resumeDB = (() => {
            const DB_NAME = 'vereloop';
            const STORE = 'resumes';
            let db;

            function open() {
                return new Promise((resolve, reject) => {
                    if (db) return resolve(db);
                    const req = indexedDB.open(DB_NAME, 1);
                    req.onupgradeneeded = (e) => {
                        const _db = e.target.result;
                        if (!_db.objectStoreNames.contains(STORE)) {
                            _db.createObjectStore(STORE, { keyPath: 'id', autoIncrement: true });
                        }
                    };
                    req.onsuccess = () => { db = req.result; resolve(db); };
                    req.onerror = () => reject(req.error);
                });
            }

            function tx(mode = 'readonly') {
                const t = db.transaction(STORE, mode);
                return [t, t.objectStore(STORE)];
            }

            async function add({ name, mime, blob }) {
                await open();
                return new Promise((resolve, reject) => {
                    const [t, s] = tx('readwrite');
                    const now = Date.now();
                    const req = s.add({ name, mime, data: blob, created: now, updated: now });
                    req.onsuccess = () => resolve(req.result);
                    req.onerror = () => reject(req.error);
                });
            }

            async function getAll() {
                await open();
                return new Promise((resolve, reject) => {
                    const [t, s] = tx('readonly');
                    const r = s.getAll();
                    r.onsuccess = () => resolve(r.result || []);
                    r.onerror = () => reject(r.error);
                });
            }

            async function get(id) {
                await open();
                return new Promise((resolve, reject) => {
                    const [t, s] = tx('readonly');
                    const r = s.get(id);
                    r.onsuccess = () => resolve(r.result || null);
                    r.onerror = () => reject(r.error);
                });
            }

            return { open, add, getAll, get };
        })();

        // ---------- Responses DB (AI_response/responses) ----------
        const responseDB = (() => {
            const DB_NAME = 'AI_response';
            const STORE = 'responses';
            let db;

            function open() {
                return new Promise((resolve, reject) => {
                    if (db) return resolve(db);
                    const req = indexedDB.open(DB_NAME, 1);
                    req.onupgradeneeded = (e) => {
                        const _db = e.target.result;
                        if (!_db.objectStoreNames.contains(STORE)) {
                            const os = _db.createObjectStore(STORE, { keyPath: 'id', autoIncrement: true });
                            os.createIndex('created', 'created', { unique: false });
                        }
                    };
                    req.onsuccess = () => { db = req.result; resolve(db); };
                    req.onerror = () => reject(req.error);
                });
            }

            function tx(mode = 'readonly') {
                const t = db.transaction(STORE, mode);
                return [t, t.objectStore(STORE)];
            }

            async function add(payload, label) {
                await open();
                return new Promise((resolve, reject) => {
                    const now = Date.now();
                    const [t, s] = tx('readwrite');
                    const rec = {
                        label: label || deriveTitle(payload) || 'AI Response',
                        created: now,
                        data: payload
                    };
                    const req = s.add(rec);
                    req.onsuccess = async () => { await trimToMax(10); resolve(req.result); };
                    req.onerror = () => reject(req.error);
                });
            }

            async function all() {
                await open();
                return new Promise((resolve, reject) => {
                    const [t, s] = tx('readonly');
                    const r = s.getAll();
                    r.onsuccess = () => resolve(r.result || []);
                    r.onerror = () => reject(r.error);
                });
            }

            async function get(id) {
                await open();
                return new Promise((resolve, reject) => {
                    const [t, s] = tx('readonly');
                    const r = s.get(id);
                    r.onsuccess = () => resolve(r.result || null);
                    r.onerror = () => reject(r.error);
                });
            }

            async function updateLabel(id, newLabel) {
                await open();
                return new Promise((resolve, reject) => {
                    const [t, s] = tx('readwrite');
                    const getReq = s.get(id);
                    getReq.onsuccess = () => {
                        const rec = getReq.result;
                        if (!rec) return reject(new Error('Not found'));
                        rec.label = newLabel;
                        const putReq = s.put(rec);
                        putReq.onsuccess = () => resolve(true);
                        putReq.onerror = () => reject(putReq.error);
                    };
                    getReq.onerror = () => reject(getReq.error);
                });
            }

            async function remove(id) {
                await open();
                return new Promise((resolve, reject) => {
                    const [t, s] = tx('readwrite');
                    const req = s.delete(id);
                    req.onsuccess = () => resolve(true);
                    req.onerror = () => reject(req.error);
                });
            }

            async function trimToMax(max) {
                const items = await all();
                if (items.length <= max) return true;
                items.sort((a, b) => (a.created || 0) - (b.created || 0)); // oldest first
                await open();
                return new Promise((resolve) => {
                    const [t, s] = tx('readwrite');
                    const toDelete = items.length - max;
                    for (let i = 0; i < toDelete; i++) s.delete(items[i].id);
                    t.oncomplete = () => resolve(true);
                });
            }

            function deriveTitle(json) {
                if (json?.analysis?.overall_match) return json.analysis.overall_match.slice(0, 60);
                if (json?.title) return json.title;
                return `AI Response ‚Äì ${new Date().toLocaleString()}`;
            }

            return { open, add, all, get, updateLabel, remove };
        })();

        // ---------- Resume UI ----------
        const resumeBox = document.getElementById('resumeUploadBox');
        const resumeFileInput = resumeBox.querySelector('#resumeFile');
        const resumeSelect = resumeBox.querySelector('#resumeSelect');
        const resumeRefreshBtn = document.getElementById('resumeRefreshBtn');
        const resumeViewBtn = document.getElementById('resumeViewBtn');
        const fileMeta = document.getElementById('fileMeta');
        const choiceHint = document.getElementById('choiceHint');
        const analyzeBtn = document.getElementById('analyzeBtn');

        async function populateResumeDropdown() {
            await resumeDB.open();
            const items = await resumeDB.getAll();
            items.sort((a, b) => (b.updated || 0) - (a.updated || 0) || (b.created || 0) - (a.created || 0));
            resumeSelect.innerHTML = '<option value="" selected disabled>-- Select from saved resumes --</option>';
            for (const r of items) {
                const opt = document.createElement('option');
                opt.value = r.id;
                opt.textContent = r.name;
                resumeSelect.appendChild(opt);
            }
        }

        resumeFileInput.addEventListener('change', () => {
            const f = resumeFileInput.files[0];
            if (f) {
                fileMeta.textContent = `Selected: ${f.name} ‚Ä¢ ${formatBytes(f.size)} ‚Ä¢ ${f.type || 'unknown'}`;
                if (choiceHint) choiceHint.textContent = 'This uploaded file will be used for analysis.';
            } else {
                fileMeta.textContent = '';
                if (choiceHint) choiceHint.textContent = 'Tip: If you select a file, it takes priority over the dropdown.';
            }
        });

        resumeRefreshBtn.addEventListener('click', populateResumeDropdown);

        resumeViewBtn.addEventListener('click', async () => {
            const id = Number(resumeSelect.value);
            if (!id) return alert('Select a saved resume first.');
            const rec = await resumeDB.get(id);
            if (!rec || !rec.data) return alert('Resume not found.');
            const blob = rec.data instanceof Blob ? rec.data : new Blob([rec.data], { type: rec.mime || 'application/octet-stream' });
            const url = URL.createObjectURL(blob);
            window.open(url, '_blank');
            setTimeout(() => URL.revokeObjectURL(url), 10_000);
        });

        async function getChosenResume() {
            const f = resumeFileInput.files?.[0];
            if (f) return { name: f.name, blob: f, source: 'upload' };
            const id = Number(resumeSelect.value);
            if (!id) return null;
            const rec = await resumeDB.get(id);
            if (!rec) return null;
            const blob = rec.data instanceof Blob ? rec.data : new Blob([rec.data], { type: rec.mime || 'application/octet-stream' });
            return { name: rec.name, blob, source: 'indexeddb', id };
        }

        analyzeBtn.addEventListener('click', async () => {
            const chosen = await getChosenResume();
            if (!chosen) { alert('Please upload a resume or choose one from the list.'); return; }

            const formData = new FormData();
            formData.append('Upload Resume', chosen.blob);
            formData.append('Upload the Job description', document.getElementById('jobDescription').value.trim());

            formSection.style.display = 'none';
            loadingScreen.style.display = 'block';

            try {
                const resp = await fetch('https://n8n.srv968815.hstgr.cloud/webhook/dea597e9-2b33-4067-a662-3087c45a956d', { method: 'POST', body: formData });
                const result = await resp.json().catch(() => ({}));

                // show UI again
                loadingScreen.style.display = 'none';
                formSection.style.display = 'block';

                // Save uploaded file to IndexedDB (don‚Äôt duplicate if it came from IDB)
                if (chosen.source === 'upload') {
                    await resumeDB.add({ name: chosen.name, mime: chosen.blob.type || 'application/octet-stream', blob: chosen.blob });
                    resumeFileInput.value = '';
                    await populateResumeDropdown();
                }

                // Render (stub if not defined elsewhere)
                // (window.renderAnalysis || ((x) => console.log('analysis', x)))(result);

                const json = result;
                const newId = await responseDB.add(json);
                await renderResponsesDropdown(newId);

            } catch (err) {
                loadingScreen.style.display = 'none';
                formSection.style.display = 'block';
                alert('Failed to analyze resume: ' + err);
            }
        });

        // ---------- Responses UI ----------
        const respSelect = document.getElementById('respSelect');
        const respViewBtn = document.getElementById('respViewBtn');
        const respRenameBtn = document.getElementById('respRenameBtn');
        const respDeleteBtn = document.getElementById('respDeleteBtn');
        const respRefreshBtn = document.getElementById('respRefreshBtn');
        const simulateBtn = document.getElementById('respSimulatePost');
        const statusEl = document.getElementById('status');

        async function renderResponsesDropdown(selectedId = null) {
            await responseDB.open();
            const rows = await responseDB.all();
            rows.sort((a, b) => (b.created || 0) - (a.created || 0));
            respSelect.innerHTML = '<option value="" selected disabled>-- Select a saved response --</option>';
            for (const r of rows) {
                const opt = document.createElement('option');
                opt.value = String(r.id);
                opt.textContent = `${r.label} ‚Ä¢ ${new Date(r.created).toLocaleString()}`;
                respSelect.appendChild(opt);
            }
            if (selectedId) {
                const found = [...respSelect.options].find(o => Number(o.value) === selectedId);
                if (found) found.selected = true;
            }
        }

        respViewBtn.addEventListener('click', async () => {
            const id = Number(respSelect.value);
            if (!id) return alert('Choose a saved response.');
            window.open(`/resume/resume/ai_response.html?id=${encodeURIComponent(id)}`, '_blank');
        });

        respRenameBtn.addEventListener('click', async () => {
            const id = Number(respSelect.value);
            if (!id) return alert('Select a response to rename.');
            const currentOpt = respSelect.options[respSelect.selectedIndex]?.textContent || '';
            const currentLabel = currentOpt.split(' ‚Ä¢ ')[0];
            const newLabel = prompt('New label:', currentLabel);
            if (!newLabel?.trim()) return;
            await responseDB.updateLabel(id, newLabel.trim());
            await renderResponsesDropdown(id);
        });

        respDeleteBtn.addEventListener('click', async () => {
            const id = Number(respSelect.value);
            if (!id) return alert('Select a response to delete.');
            if (!confirm('Delete this saved response? This cannot be undone.')) return;
            await responseDB.remove(id);
            await renderResponsesDropdown();
        });

        // simulateBtn.addEventListener('click', async () => {
        //     statusEl.textContent = 'Submitting‚Ä¶';
        //     try {
        //         const json = {
        //             analysis: { overall_match: 'Strong Azure + Spark alignment' },
        //             match_percentage: Math.floor(Math.random() * 20) + 70,
        //             created_at: new Date().toISOString()
        //         };
        //         const newId = await responseDB.add(json);
        //         await renderResponsesDropdown(newId);
        //         statusEl.textContent = 'Saved ‚úî';
        //         setTimeout(() => (statusEl.textContent = ''), 1500);
        //     } catch (e) {
        //         console.error(e);
        //         statusEl.textContent = 'Failed to save: ' + e;
        //     }
        // });

        // ---------- Init ----------
        (async () => {
            await resumeDB.open();
            await responseDB.open();
            await populateResumeDropdown();
            await renderResponsesDropdown();
        })();
    </script>

</body>

</html>