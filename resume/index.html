<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="Vereloop ‚Äì Optimize Your Resume with AI">
  <meta property="og:description"
    content="Instant resume analysis. Upload your resume and get job match scores, missing keywords, and optimization tips.">
  <meta property="og:image" content="https://vereloop.com/assets/og-image.jpg">
  <meta property="og:url" content="https://vereloop.com">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="google-site-verification" content="CqUR0V0tOlkzDOC62u2_KwmilVNQYtp1EYmQ1kG-77Q" />

  <title>Chat with Resume</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9f9f9;
      color: #1f2937;
    }

    .container {
      max-width: 900px;
      margin: 2rem auto;
      padding: 2rem;
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
    }

    .section {
      margin-bottom: 30px;
    }

    .section {
      margin-bottom: 30px;
    }

    .keywords span {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 20px;
      margin: 5px 6px 0 0;
      font-size: 14px;
    }

    .missing {
      background: #fee2e2;
      color: #b91c1c;
    }

    .found {
      background: #dcfce7;
      color: #166534;
    }

    .badge {
      padding: 2px 8px;
      border-radius: 9999px;
      font-size: 12px;
      margin-left: 8px;
    }

    .technical {
      background: #ede9fe;
      color: #7c3aed;
    }

    .soft {
      background: #dcfce7;
      color: #15803d;
    }

    .domain {
      background: #fed7aa;
      color: #c2410c;
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      background: #e5e7eb;
      border-radius: 5px;
      overflow: hidden;
      margin-top: 5px;
    }

    .progress {
      height: 10px;
      background: #7c3aed;
    }

    ul li {
      margin-bottom: 8px;
    }

    .score {
      font-size: 40px;
      font-weight: bold;
      color: #dc2626;
    }

    .title-section {
      text-align: center;
    }

    .title-section h1 {
      font-size: 2rem;
      color: #6a0dad;
    }

    .title-section p {
      margin-top: 0.5rem;
      color: #555;
    }

    .input-sections {
      display: flex;
      gap: 2rem;
      margin-top: 2rem;
    }

    .box {
      flex: 1;
      border: 2px dashed #d3bfff;
      padding: 1.5rem;
      border-radius: 10px;
      text-align: center;
      background-color: #f9f5ff;
      position: relative;
    }

    .box h3 {
      margin-top: 0;
      color: #6a0dad;
    }

    .box input[type="file"],
    .box textarea {
      margin-top: 1rem;
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
    }

    .step-label {
      position: absolute;
      top: -15px;
      left: 15px;
      background-color: #ede3ff;
      color: #6a0dad;
      font-weight: bold;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 0.85rem;
    }

    .button-wrapper {
      text-align: center;
      margin-top: 2rem;
    }

    .button-wrapper button {
      background-color: #a56bff;
      color: white;
      padding: 0.75rem 2rem;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      opacity: 1;
    }

    .features {
      display: flex;
      gap: 2rem;
      margin-top: 2rem;
    }

    .feature-box {
      flex: 1;
      background-color: #f4edff;
      padding: 1.5rem;
      border-radius: 10px;
      text-align: center;
    }

    .feature-box h4 {
      color: #6a0dad;
      margin-bottom: 0.5rem;
    }

    #form-section,
    #loading_screen,
    #analysis-section {
      display: none;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 6px solid #e5e7eb;
      border-top: 6px solid #7c3aed;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: auto;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .row {
      display: flex;
      gap: .75rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .meta {
      font-size: .9rem;
      color: #6b7280;
      margin-top: .5rem;
    }

    .divider {
      height: 1px;
      background: #e5e7eb;
      margin: 1rem 0;
    }

    .hint {
      font-size: .9rem;
      color: #6b7280;
      margin-top: .5rem;
    }

    .empty {
      background: #f3f4f6;
      border: 1px dashed #d1d5db;
      color: #6b7280;
      padding: .85rem 1rem;
      border-radius: 10px;
    }
  </style>
</head>

<body>
  <!--form-section -->
  <div class="container" id="form-section">

    <div id="header-placeholder"></div>

    <div class="title-section">
      <h1>Get Your Resume <strong>Analyzed</strong></h1>
      <p>Upload your resume and job description to get detailed insights, improvement suggestions, and match
        analysis
        powered by AI.</p>
    </div>

    <section style="max-width: 960px; margin: 0 auto; padding: 2rem; text-align: center;">
      <h2 style="font-size: 2rem; color: #4f46e5; margin-bottom: 0.5rem;">üé• How Vereloop Works</h2>
      <p style="font-size: 1.1rem; margin-bottom: 1.5rem; color: #374151;">
        Following is a quick visual breaksown to get an instant match score, keyword breakdown, and smart
        resume tips.
      </p>
      <img
        src="https://vereloopadls.blob.core.windows.net/vereloop/vereloop-demo.gif?sp=r&st=2025-08-14T09:22:33Z&se=2026-08-14T17:37:33Z&spr=https&sv=2024-11-04&sr=b&sig=dVfCF09LuzRiSjgZT7BIDua12MbXhTkCan64AHiHdMg%3D"
        alt="Product Walkthrough GIF"
        style="max-width: 100%; border-radius: 8px; box-shadow: 0 5px 25px rgba(0,0,0,0.05);" />
    </section>

    <div class="input-sections">

      <div class="box" id="resumeUploadBox">
        <div class="step-label">1 Upload Resume</div>
        <h3 id="uploadTitle">Upload Resume</h3>
        <p id="uploadPrompt">Choose from dropdown or drop your PDF file here or click to browse</p>
        <input type="file" id="resumeFile" accept=".pdf">

        <div class="row">
          <select id="resumeSelect" aria-label="Choose a resume"></select>
          <button id="refreshBtn" class="ghost">Refresh</button>
          <button id="viewBtn" class="ghost">View</button>
          <button id="analyzeBtn" class="primary">Use in analysis</button>
        </div>

        <div id="resumeMeta" class="meta"></div>

        <div class="divider"></div>

        <p class="hint">Tip: The newest resume appears first. You can rename or add resumes on the ‚ÄúMy Documents‚Äù page.
        </p>

        <div id="emptyState" class="empty" style="display:none; margin-top:1rem;">
          No resumes found in IndexedDB. Please upload one on the <a href="/documents.html">My Documents</a> page first.
        </div>

        <!-- File details preview -->
        <div id="fileInfo"
          style="display: none; margin-top: 10px; align-items: center; justify-content: space-between;">
          <div style="display: flex; align-items: center;">
            <strong id="fileName">Uploaded file.pdf</strong>
            <button id="viewFileBtn"
              style="display: none; margin-left: 10px; padding: 4px 10px; font-size: 0.85rem; cursor: pointer;">üëÅÔ∏è
              View</button>
          </div>
          <button id="removeFileBtn"
            style="display: none; margin-left: 10px; padding: 4px 10px; font-size: 0.85rem; background-color: #f87171; color: white; border: none; border-radius: 4px; cursor: pointer;">‚úñ
            Remove</button>
        </div>
      </div>

      <div class="box">
        <div class="step-label">2 Job Description</div>
        <h3>Job Description</h3>
        <p>Paste the complete job description here</p>
        <textarea id="jobDescription" rows="8"
          placeholder="Include responsibilities, skills, and requirements..."></textarea>
      </div>
    </div>

    <div class="button-wrapper">
      <button id="analyzeBtn">Analyze Resume</button>
      <p style="margin-top: 0.5rem; color: #999;">Please upload your resume and provide a job description to
        continue
      </p>
    </div>

    <div class="features">
      <div class="feature-box">
        <h4>Resume Matching</h4>
        <p>Get a detailed relevancy score showing how well your resume matches the job requirements.</p>
      </div>
      <div class="feature-box">
        <h4>Skills Analysis</h4>
        <p>Identify missing keywords and skills to help optimize your resume for ATS systems.</p>
      </div>
      <div class="feature-box">
        <h4>AI Recommendations</h4>
        <p>Receive personalized suggestions to improve your resume and increase your chances.</p>
      </div>
    </div>

  </div>

  <!--loading_screen -->
  <div id="loading_screen" style="display: none; text-align: center; padding: 50px;">
    <div class="spinner"></div>
    <p style="margin-top: 20px; font-size: 1.2rem; color: #7c3aed;">Analyzing your resume with AI magic...</p>
  </div>

  <!--analysis-section -->
  <div class="container" id="analysis-section"
    style="font-family: 'Inter', sans-serif; max-width: 1000px; margin: auto; padding: 2rem; background: #ffffff; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.05);">
  </div>

  <script>
    fetch("/reusables/header.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("header-placeholder").innerHTML = html;
      });

    /* === IndexedDB access (matches your existing schema) === */
    const DB_NAME = 'vereloopDB';
    const STORE = 'resumes';
    let db;

    function openDB() {
      return new Promise((resolve, reject) => {
        const req = indexedDB.open(DB_NAME, 1);
        req.onupgradeneeded = (e) => {
          const _db = e.target.result;
          if (!_db.objectStoreNames.contains(STORE)) {
            _db.createObjectStore(STORE, { keyPath: 'id', autoIncrement: true });
          }
        };
        req.onsuccess = () => { db = req.result; resolve(db); };
        req.onerror = () => reject(req.error);
      });
    }

    function getAllResumes() {
      return new Promise((resolve, reject) => {
        const tx = db.transaction(STORE, 'readonly');
        const store = tx.objectStore(STORE);
        const req = store.getAll();
        req.onsuccess = () => resolve(req.result || []);
        req.onerror = () => reject(req.error);
      });
    }

    function getResumeById(id) {
      return new Promise((resolve, reject) => {
        const tx = db.transaction(STORE, 'readonly');
        const store = tx.objectStore(STORE);
        const req = store.get(id);
        req.onsuccess = () => resolve(req.result || null);
        req.onerror = () => reject(req.error);
      });
    }

    /* === UI Elements === */
    const resumeSelect = document.getElementById('resumeSelect');
    const refreshBtn = document.getElementById('refreshBtn');
    const viewBtn = document.getElementById('viewBtn');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const jobDescEl = document.getElementById('jobDesc');
    const resumeMetaEl = document.getElementById('resumeMeta');
    const emptyState = document.getElementById('emptyState');

    /* === Helpers === */
    function formatBytes(n) {
      if (n == null) return '‚Äî';
      const u = ['B', 'KB', 'MB', 'GB', 'TB'];
      let i = 0;
      while (n >= 1024 && i < u.length - 1) { n /= 1024; i++; }
      const fixed = (n < 10 && i > 0) ? n.toFixed(1) : Math.round(n);
      return `${fixed} ${u[i]}`;
    }
    function fmtDate(d) { return new Date(d).toLocaleString(); }

    /* === Populate dropdown === */
    async function loadDropdown() {
      const items = await getAllResumes();
      // sort: latest first (updated desc, then created desc)
      items.sort((a, b) => (b.updated ?? 0) - (a.updated ?? 0) || (b.created ?? 0) - (a.created ?? 0));

      resumeSelect.innerHTML = '';
      if (!items.length) {
        emptyState.style.display = 'block';
        resumeSelect.disabled = true;
        viewBtn.disabled = true;
        analyzeBtn.disabled = true;
        resumeMetaEl.textContent = '';
        return;
      }

      emptyState.style.display = 'none';
      resumeSelect.disabled = false;
      viewBtn.disabled = false;
      analyzeBtn.disabled = false;

      items.forEach(item => {
        const opt = document.createElement('option');
        opt.value = item.id;
        opt.textContent = `${item.name}`;
        // Attach some data for quick meta display
        opt.dataset.size = item.size || item.data?.byteLength || 0;
        opt.dataset.created = item.created || 0;
        opt.dataset.updated = item.updated || 0;
        opt.dataset.mime = item.mime || '';
        resumeSelect.appendChild(opt);
      });

      // Select first (newest) by default
      resumeSelect.selectedIndex = 0;
      showMetaForSelected();
    }

    /* === Meta display === */
    function showMetaForSelected() {
      const opt = resumeSelect.options[resumeSelect.selectedIndex];
      if (!opt) { resumeMetaEl.textContent = ''; return; }
      const size = Number(opt.dataset.size || 0);
      const created = Number(opt.dataset.created || 0);
      const updated = Number(opt.dataset.updated || 0);
      const mime = opt.dataset.mime || '';
      resumeMetaEl.textContent = `Size: ${formatBytes(size)}   ‚Ä¢   Type: ${mime || '‚Äî'}   ‚Ä¢   Created: ${created ? fmtDate(created) : '‚Äî'}   ‚Ä¢   Updated: ${updated ? fmtDate(updated) : '‚Äî'}`;
    }

    /* === Actions === */
    resumeSelect.addEventListener('change', showMetaForSelected);

    refreshBtn.addEventListener('click', async () => {
      await loadDropdown();
    });

    viewBtn.addEventListener('click', async () => {
      const id = Number(resumeSelect.value);
      if (!id) return;
      const rec = await getResumeById(id);
      if (!rec) return alert('Resume not found.');
      const blob = rec.data instanceof Blob ? rec.data : new Blob([rec.data], { type: rec.mime || 'application/octet-stream' });
      const url = URL.createObjectURL(blob);
      window.open(url, '_blank');
      setTimeout(() => URL.revokeObjectURL(url), 10000);
    });

    // Example: prepare data for analyze (send to your backend or n8n)
    analyzeBtn.addEventListener('click', async () => {
      const id = Number(resumeSelect.value);
      if (!id) return alert('Please select a resume.');
      const rec = await getResumeById(id);
      if (!rec) return alert('Resume not found.');

      const blob = rec.data instanceof Blob ? rec.data : new Blob([rec.data], { type: rec.mime || 'application/octet-stream' });
      const form = new FormData();
      form.append('resume', blob, rec.name);
      form.append('job_description', jobDescEl.value || '');

      // Example fetch to your workflow endpoint:
      // const res = await fetch('https://your-n8n-or-backend-endpoint', { method: 'POST', body: form });
      // const json = await res.json();
      // console.log('Analysis response:', json);

      alert(`Ready to analyze: ${rec.name}\n(Replace the fetch() with your endpoint to send resume + job description.)`);
    });


    const fileInput = document.getElementById('resumeFile');
    const fileInfo = document.getElementById('fileInfo');
    const fileNameSpan = document.getElementById('fileName');
    const viewFileBtn = document.getElementById('viewFileBtn');
    const removeFileBtn = document.getElementById('removeFileBtn');
    const uploadTitle = document.getElementById('uploadTitle');
    const uploadPrompt = document.getElementById('uploadPrompt');

    let resumeBlobURL = null;

    fileInput.addEventListener('change', () => {
      const file = fileInput.files[0];
      if (!file) return;

      fileNameSpan.textContent = file.name;
      fileInfo.style.display = 'flex';
      viewFileBtn.style.display = 'inline-block';
      removeFileBtn.style.display = 'inline-block';
      uploadTitle.textContent = 'Resume uploaded ‚úÖ';
      uploadPrompt.textContent = '';

      if (resumeBlobURL) {
        URL.revokeObjectURL(resumeBlobURL);
      }

      resumeBlobURL = URL.createObjectURL(file);
      viewFileBtn.onclick = () => {
        window.open(resumeBlobURL, '_blank');
      };
    });

    removeFileBtn.addEventListener('click', () => {
      fileInput.value = '';
      fileInfo.style.display = 'none';
      viewFileBtn.style.display = 'none';
      removeFileBtn.style.display = 'none';
      uploadTitle.textContent = 'Upload Resume';
      uploadPrompt.textContent = 'Drop your PDF file here, or click to browse';

      if (resumeBlobURL) {
        URL.revokeObjectURL(resumeBlobURL);
        resumeBlobURL = null;
      }
    });



    const formSection = document.getElementById('form-section');
    const loadingscreen = document.getElementById('loading_screen');
    const analysisSection = document.getElementById('analysis-section');

    function renderAnalysis(analysisData) {
      function createList(items) {
        return '<ul style="padding-left: 1.25rem;">' + items.map(i => `<li>${i}</li>`).join('') + '</ul>';
      }

      const container = document.getElementById("analysis-section");
      container.innerHTML = `
            <h2 style="color: #7c3aed;">üîç Overall Match Summary</h2>
            <p>${analysisData.overall_match}</p>

            <h3 style="color: #4c1d95;">‚úÖ Skills & Experience Found in Both</h3>
            ${createList(analysisData.key_skills_exp_phrases_found_in_both)}

            <h3 style="color: #b91c1c;">‚ùå Missing but Important for Job</h3>
            ${createList(analysisData.key_skills_exp_phrases_missing_from_resume_but_important_in_job)}

            <h3 style="color: #0f766e;">üìä Match Score: <span style="font-size: 1.5rem; font-weight: 600;">${analysisData.match_percentage}%</span></h3>
            <p>${analysisData.match_percentage_explanation}</p>

            <h3 style="color: #3b0764;">‚≠ê Rating: ${analysisData.rating}/5</h3>
            <p>${analysisData.rating_justification}</p>

            <h3 style="color: #1e3a8a;">üìÑ Tailored ATS-Optimized Resume</h3>
            <pre style="background: #f9fafb; padding: 1rem; border-radius: 8px; overflow-x: auto; margin-bottom: 2rem; font-size: 0.95rem; line-height: 1.4;">${analysisData.tailored_ats_optimized_resume}</pre>

            <h3 style="color: #4b5563;">üí° Summary & Tips</h3>
            <p>${analysisData.summary_and_tips}</p>

            <h3 style="color: #ca8a04;">üõ†Ô∏è Optional Suggestions</h3>
            ${createList(analysisData.optional_suggestions)}
        `;
    }

    function openDB() {
      return new Promise((resolve, reject) => {
        const req = indexedDB.open(DB_NAME, 1);
        req.onupgradeneeded = (e) => {
          const _db = e.target.result;
          if (!_db.objectStoreNames.contains(STORE)) {
            const os = _db.createObjectStore(STORE, { keyPath: 'id', autoIncrement: true });
            os.createIndex('name', 'name', { unique: false });
            os.createIndex('created', 'created', { unique: false });
          }
        };
        req.onsuccess = () => { db = req.result; resolve(db); };
        req.onerror = () => reject(req.error);
      });
    }

    function txStore(mode = 'readonly') {
      const tx = db.transaction(STORE, mode);
      return [tx, tx.objectStore(STORE)];
    }

    function addResumeRecord({ name, mime, blob }) {
      return new Promise((resolve, reject) => {
        const now = Date.now();
        const [tx, store] = txStore('readwrite');
        const req = store.add({ name, mime, created: now, updated: now, data: blob });
        req.onsuccess = () => resolve(req.result);
        req.onerror = () => reject(req.error);
      });
    }

    document.getElementById('analyzeBtn').addEventListener('click', async () => {
      const resumeFile = document.getElementById('resumeFile').files[0];
      const jobDesc = document.getElementById('jobDescription').value.trim();

      if (!resumeFile || !jobDesc) {
        alert("Please upload a resume and provide a job description.");
        return;
      }
      const formData = new FormData();
      formData.append('Upload Resume', resumeFile);
      formData.append('Upload the Job description', jobDesc);

      formSection.style.display = 'none';
      loadingscreen.style.display = 'block';

      try {
        const response = await fetch('https://n8n.srv968815.hstgr.cloud/webhook/dea597e9-2b33-4067-a662-3087c45a956d', {
          method: 'POST',
          body: formData
        });

        loadingscreen.style.display = 'none';
        analysisSection.style.display = 'block';

        const result = await response.json();
        //const result = await response.text();
        renderAnalysis(result);
        //alert("resume: " + result);
      } catch (err) {
        alert("Failed to analyze resume: " + err);
      }

      // Store the File directly as a Blob in IDB
      await addResumeRecord({ name: resumeFile.name, mime: resumeFile.type || 'application/octet-stream', blob: resumeFile });
      fileInput.value = '';

    });

    // Default view
    formSection.style.display = 'block';

    /* =========================
       Init
    ========================= */
    (async function init() {
      await openDB();
      await loadDropdown();
      updateTable();
      // Optional: request persistent storage (reduces eviction risk)
      try { await navigator.storage?.persist?.(); } catch { }
    })();
  </script>
</body>

</html>